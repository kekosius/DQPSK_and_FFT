<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DQPSK_plus_Freq: Documents/Keil/DQPSK_plus_Freq/Source/TIM_lib.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DQPSK_plus_Freq
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_t_i_m__lib_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">TIM_lib.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Функции для работы с прерываниями таймеров  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;TIM_lib.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad4667872eeecb6411675ef94133723fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#ad4667872eeecb6411675ef94133723fd">TMR2_Init</a> ()</td></tr>
<tr class="memdesc:ad4667872eeecb6411675ef94133723fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Инициализация таймера TIM2.  <br /></td></tr>
<tr class="separator:ad4667872eeecb6411675ef94133723fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d47a34e2c52ccf4c024d63bf7172903"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a9d47a34e2c52ccf4c024d63bf7172903">TMR3_Init</a> ()</td></tr>
<tr class="memdesc:a9d47a34e2c52ccf4c024d63bf7172903"><td class="mdescLeft">&#160;</td><td class="mdescRight">Инициализация таймера TIM3.  <br /></td></tr>
<tr class="separator:a9d47a34e2c52ccf4c024d63bf7172903"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6fb208c5073bb9ca92da2606a78df00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#aa6fb208c5073bb9ca92da2606a78df00">TMR4_Init</a> ()</td></tr>
<tr class="memdesc:aa6fb208c5073bb9ca92da2606a78df00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Инициализация таймера TIM4.  <br /></td></tr>
<tr class="separator:aa6fb208c5073bb9ca92da2606a78df00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a79c36e2eef10dc903cea4c011028b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a8a79c36e2eef10dc903cea4c011028b3">TMR2_EventCallback</a> ()</td></tr>
<tr class="memdesc:a8a79c36e2eef10dc903cea4c011028b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Прерывание таймера TIM2.  <br /></td></tr>
<tr class="separator:a8a79c36e2eef10dc903cea4c011028b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae928af867d4f146922f1cb3af9bbf017"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017">TMR3_EventCallback</a> (void)</td></tr>
<tr class="memdesc:ae928af867d4f146922f1cb3af9bbf017"><td class="mdescLeft">&#160;</td><td class="mdescRight">Прерывание таймера TIM3.  <br /></td></tr>
<tr class="separator:ae928af867d4f146922f1cb3af9bbf017"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaebebda4c5e39aee196bc2573f9a705f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#aaebebda4c5e39aee196bc2573f9a705f">TMR4_EventCallback</a> (void)</td></tr>
<tr class="memdesc:aaebebda4c5e39aee196bc2573f9a705f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Прерывание таймера TIM4.  <br /></td></tr>
<tr class="separator:aaebebda4c5e39aee196bc2573f9a705f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3a65c2b73922e31541ebbd6beeded46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#ab3a65c2b73922e31541ebbd6beeded46">SpectrumVarReInit</a> ()</td></tr>
<tr class="memdesc:ab3a65c2b73922e31541ebbd6beeded46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Обнуление переменных и массивов, используемых в АРС режиме  <br /></td></tr>
<tr class="separator:ab3a65c2b73922e31541ebbd6beeded46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f9bd7b9273ce18ca6275e4a3f943eda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a2f9bd7b9273ce18ca6275e4a3f943eda">VarReInit</a> ()</td></tr>
<tr class="memdesc:a2f9bd7b9273ce18ca6275e4a3f943eda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Обнуление переменных и массивов, используемых в АРСФ режиме  <br /></td></tr>
<tr class="separator:a2f9bd7b9273ce18ca6275e4a3f943eda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b9e5342fe44b8cef1b6c3fbfba6eaac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a7b9e5342fe44b8cef1b6c3fbfba6eaac">FlagsClear</a> ()</td></tr>
<tr class="memdesc:a7b9e5342fe44b8cef1b6c3fbfba6eaac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Очистка флагов перефирии  <br /></td></tr>
<tr class="separator:a7b9e5342fe44b8cef1b6c3fbfba6eaac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a65abd7c55078faafaee66951c6aa38e2"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a65abd7c55078faafaee66951c6aa38e2">FalseActivation</a> = 0</td></tr>
<tr class="separator:a65abd7c55078faafaee66951c6aa38e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06d87010c135671bee571365d31ba043"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a06d87010c135671bee571365d31ba043">LowLevel</a> = 1</td></tr>
<tr class="separator:a06d87010c135671bee571365d31ba043"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7eacd3464df86c7d1cfc2f6435e76b8"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#af7eacd3464df86c7d1cfc2f6435e76b8">fft_pos</a> = 0</td></tr>
<tr class="separator:af7eacd3464df86c7d1cfc2f6435e76b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad14650db362e7e1e1d34b5a4084cc9f1"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a> [8 *5+2+1] = {0}</td></tr>
<tr class="separator:ad14650db362e7e1e1d34b5a4084cc9f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c38447b8253c8df855e3131c95941a1"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a2c38447b8253c8df855e3131c95941a1">tick</a> = 0</td></tr>
<tr class="separator:a2c38447b8253c8df855e3131c95941a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74adc192bb0536a83f57a129efa1400f"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a74adc192bb0536a83f57a129efa1400f">voltageBuffCounter</a> = 0</td></tr>
<tr class="separator:a74adc192bb0536a83f57a129efa1400f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43d2c695c558f49cb2df8c0745c28531"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a> [700] = {0}</td></tr>
<tr class="separator:a43d2c695c558f49cb2df8c0745c28531"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7558533ab0553c6f22905cb4a83f93c3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a> [(32+5 *8 *16) *8] = {0}</td></tr>
<tr class="separator:a7558533ab0553c6f22905cb4a83f93c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2093496d4e94f2686e755b4836a9586f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a2093496d4e94f2686e755b4836a9586f">RealVoltage</a> = 0</td></tr>
<tr class="separator:a2093496d4e94f2686e755b4836a9586f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c8f21a03cfb93d09d39d6afb04fbf5a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a0c8f21a03cfb93d09d39d6afb04fbf5a">PrevVoltage</a> = 0</td></tr>
<tr class="separator:a0c8f21a03cfb93d09d39d6afb04fbf5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a023d44daad4b1ebc1b7dfe8ed37cc27b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a023d44daad4b1ebc1b7dfe8ed37cc27b">FFT_Buff</a> [FFT_N] = {0}</td></tr>
<tr class="separator:a023d44daad4b1ebc1b7dfe8ed37cc27b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42489e419158b2e29f4d5ab5631ebc1f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_i_m__lib_8c.html#a42489e419158b2e29f4d5ab5631ebc1f">voltageBuff</a> [VOL_BUF_LEN] = {0}</td></tr>
<tr class="separator:a42489e419158b2e29f4d5ab5631ebc1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Функции для работы с прерываниями таймеров </p>
<dl class="section version"><dt>Version</dt><dd>V1.0.0</dd></dl>
<dl class="section date"><dt>Date</dt><dd>12-09-2023 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7b9e5342fe44b8cef1b6c3fbfba6eaac" name="a7b9e5342fe44b8cef1b6c3fbfba6eaac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b9e5342fe44b8cef1b6c3fbfba6eaac">&#9670;&#160;</a></span>FlagsClear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FlagsClear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Очистка флагов перефирии </p>
<p>Очищает флаги прерываний таймеров TIM2 и TIM3, а также флаг готовности АЦП к передачи текущего принятого значения напряжения </p>

</div>
</div>
<a id="ab3a65c2b73922e31541ebbd6beeded46" name="ab3a65c2b73922e31541ebbd6beeded46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3a65c2b73922e31541ebbd6beeded46">&#9670;&#160;</a></span>SpectrumVarReInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpectrumVarReInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Обнуление переменных и массивов, используемых в АРС режиме </p>
<p>Обнуляемые переменные и массивы:</p><ul>
<li><a class="el" href="_t_i_m__lib_8c.html#a023d44daad4b1ebc1b7dfe8ed37cc27b">FFT_Buff</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a42489e419158b2e29f4d5ab5631ebc1f">voltageBuff</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a74adc192bb0536a83f57a129efa1400f">voltageBuffCounter</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#af7eacd3464df86c7d1cfc2f6435e76b8">fft_pos</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a06d87010c135671bee571365d31ba043">LowLevel</a></li>
</ul>
<p>Используется в KEY1_IRQHandler() при переключении режимов работы устройства и в SpectrumAnalysis() после окончания приёма АРС сигнала </p>

</div>
</div>
<a id="a8a79c36e2eef10dc903cea4c011028b3" name="a8a79c36e2eef10dc903cea4c011028b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a79c36e2eef10dc903cea4c011028b3">&#9670;&#160;</a></span>TMR2_EventCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR2_EventCallback </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Прерывание таймера TIM2. </p>
<p>Прерывание таймера TIM2 обеспечивает приём АРСФ пакетов и запуск демодуляции полученного пакета.</p>
<p>Принцип работы функции следующий:</p><ul>
<li>Считывется текущее значение "подлинного" напряжения на линии АЦП (см. <a class="el" href="_a_d_c__lib_8c.html#aefac2e00e12a4d31bde8f7ee88c96c3d" title="Получение уровня напряжение с АЦП">GetRealVoltage</a>)</li>
<li>Производится проверка готовности системы к приёму нового АРСФ пакета (см. <a class="el" href="_signal_receive_handler_8c.html#aefeec6db79e536a31f0d889d4b39b64e" title="Определяет готовность системы к приёму нового АРСФ пакета">ReadyToStartReceive</a>). Если в настоящий момент прозводится приём пакета, то проверка не произвоится</li>
<li>Определение текущего момента времени на соответсвие началу нового АРСФ пакета (см. <a class="el" href="_signal_receive_handler_8c.html#afb21728292519ac5322ab0709ed8a987" title="Определяет начало нового АРСФ пакета">CatchPackageStart</a>). Если в настоящий момент прозводится приём пакета, то определение начала пакета не производится</li>
<li>Если предыдущие проверки не инициировали выход из функции прерывания, то считается, что в настоящий момент производится приём АРСФ пакета. В действительности, это не всегда так, поэтому производится проверка текущего приёма на ложное срабатывание (см. <a class="el" href="_signal_receive_handler_8c.html#aa7a4e39e588af7e90209b4822d951e60" title="Определяет ложный приём пакета">FasleActivationCatch</a>)</li>
<li>Если в течении заданного времени (5376 тиков или 201 мс), что соответсвует полному АРСФ пакету, не был определён ложный приём, то функция инициирует анализ принятого пакета. Полученные в течении времени приёма данные в <a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a> используются для анализа амплитуды в <a class="el" href="_a_m_p_8c.html#adbea7f0464f380bf508408bb38fbb5a9">AmlitudeAnalysis()</a> и для демодуляции сигнала в <a class="el" href="_signal_receive_handler_8c.html#ab53fdddca3f5eb3f9d44cdb67de13707">ReceiveStop()</a> </li>
</ul>

</div>
</div>
<a id="ad4667872eeecb6411675ef94133723fd" name="ad4667872eeecb6411675ef94133723fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4667872eeecb6411675ef94133723fd">&#9670;&#160;</a></span>TMR2_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR2_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Инициализация таймера TIM2. </p>
<p>Прерывание таймера TIM2 используется для приёма АРСФ пакетов. Таймер инициализируется со следующими параметрами:</p><ul>
<li>Частота 26785,71 Гц</li>
<li>Период 3,7(3)е-5 с</li>
</ul>
<p>Частота таймера выбрана таким образом, чтобы на каждый период принимаемой АРСФ несущей приходилось ровно 8 прерываний таймера Так, частота АРСФ несущей равна 3348,21 тогда количество прерываний на период: 26785,71/3348,21 = 8,00001. Такая частота таймера была выбрана как оптимальное значение из рассчета на количество измерений на период и вероятности возникновения ошибки т.е. остатка от деления частоты таймера на частоту несущей. Например, при выборе частоты, десятикратно превышающей несущую т.е. 10 прерываний на период, мы путём подбора делителя сможем достигнуть наиближайшей к 3348,21 * 10 частоте в 33492,82 Гц. Тогда 33492,82/3348,21 = 10,003. Остаток отделения заметно больше, значит вероятность "перескока" гораздо выше. Под "перескоком" подразумевается ситуация, когда измерения по текущему периоду происходят таким образом, что на период приходится на одно измерение больше, чем подразумевается. Происходит это из-за неточной кратности частоты и приводит к возникновению подобий фазовых переходов в местах, где их быть не должно.</p>
<p>На количество прерываний на период завязана, по большей части, вся демодуляция АРСФ пакетов и их приём. </p>

</div>
</div>
<a id="ae928af867d4f146922f1cb3af9bbf017" name="ae928af867d4f146922f1cb3af9bbf017"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae928af867d4f146922f1cb3af9bbf017">&#9670;&#160;</a></span>TMR3_EventCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR3_EventCallback </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Прерывание таймера TIM3. </p>
<p>Прерывание таймера TIM3 обеспечивает приём АРС сигнала и запуск частотного анализа полученного сигнала.</p>
<p>Принцип работы функции следующий:</p><ul>
<li>Считывется текущее значение "подлинного" напряжения на линии АЦП (см. <a class="el" href="_a_d_c__lib_8c.html#aefac2e00e12a4d31bde8f7ee88c96c3d" title="Получение уровня напряжение с АЦП">GetRealVoltage</a>)</li>
<li>Производится проверка полученного сигнала на соответсвие сигналу высокого уровня (см. <a class="el" href="_t_i_m__lib_8c.html#a06d87010c135671bee571365d31ba043">LowLevel</a>)</li>
<li>Заполнение массивов <a class="el" href="_t_i_m__lib_8c.html#a42489e419158b2e29f4d5ab5631ebc1f">voltageBuff</a> и <a class="el" href="_t_i_m__lib_8c.html#a023d44daad4b1ebc1b7dfe8ed37cc27b">FFT_Buff</a></li>
<li>После приёма VOL_BUF_LEN значений, функция инициирует спектральный анализ полученного сигнала (см. SpectrumAnalysis) </li>
</ul>

</div>
</div>
<a id="a9d47a34e2c52ccf4c024d63bf7172903" name="a9d47a34e2c52ccf4c024d63bf7172903"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d47a34e2c52ccf4c024d63bf7172903">&#9670;&#160;</a></span>TMR3_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR3_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Инициализация таймера TIM3. </p>
<p>Прерывание таймера TIM3 используется для приёма АРС сигнала. Таймер инициализируется со следующими параметрами:</p><ul>
<li>Частота 6399,51 Гц</li>
<li>Период 1,563е-4 с</li>
</ul>
<p>Частота таймера выбрана в согласовании с размером буфера <a class="el" href="_t_i_m__lib_8c.html#a023d44daad4b1ebc1b7dfe8ed37cc27b">FFT_Buff</a> таким образом, чтобы шаг частоты частотного анализа составлял 25 Гц. Благодаря этому, устройство может чётко отличить АРС код 75 Гц и 125 Гц, где разница в частотах составляет 50 Гц (справедливо и для других соседних кодов) </p>

</div>
</div>
<a id="aaebebda4c5e39aee196bc2573f9a705f" name="aaebebda4c5e39aee196bc2573f9a705f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaebebda4c5e39aee196bc2573f9a705f">&#9670;&#160;</a></span>TMR4_EventCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR4_EventCallback </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Прерывание таймера TIM4. </p>
<p>Прерывание таймера TIM4 обеспечивает информирование системы об отсутсвии приёма сигнала на линии.</p>
<p>Принцип работы функции следующий:</p><ul>
<li>Если <a class="el" href="_l_c_d__lib_8c.html#a0efe09d8a193aa45418e4c33c4f420c2">NoResultCounter</a> == 0, то инициируется отображение отсутсвия приёма на LCD экране (см. <a class="el" href="_l_c_d__lib_8c.html#ad4fcbc10f1d0f8b3738d929d33386ccc" title="Отображение состояния">LCD_Show_No_Result</a>)</li>
<li>Если <a class="el" href="_l_c_d__lib_8c.html#a0efe09d8a193aa45418e4c33c4f420c2">NoResultCounter</a> != 0, то <a class="el" href="_l_c_d__lib_8c.html#a0efe09d8a193aa45418e4c33c4f420c2">NoResultCounter</a> уменьшается на единицу</li>
</ul>
<p>При каждом новом успешном приёме сигнала (АРС или АРСФ), переменной <a class="el" href="_l_c_d__lib_8c.html#a0efe09d8a193aa45418e4c33c4f420c2">NoResultCounter</a> присваевается значение 3, происходит это в <a class="el" href="_l_c_d__lib_8c.html#a67d65e7546dc387e220507035c7c4346" title="Отображения результата декодирования АРСФ на LCD экране">LCD_DQPSK_Result</a> и <a class="el" href="_l_c_d__lib_8c.html#a9d046a321b80f763b5cdf78b26c0fbe2" title="Отображения результата декодирования АРС на LCD экране">LCD_Freq_Result</a> для АРСФ и АРС режимов соответсвенно. Таким образом, если в течении трёх стабатываний прерывания таймера TMR4 не было произведено удачного приёма, то вызывается <a class="el" href="_l_c_d__lib_8c.html#ad4fcbc10f1d0f8b3738d929d33386ccc">LCD_Show_No_Result()</a> </p>

</div>
</div>
<a id="aa6fb208c5073bb9ca92da2606a78df00" name="aa6fb208c5073bb9ca92da2606a78df00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6fb208c5073bb9ca92da2606a78df00">&#9670;&#160;</a></span>TMR4_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TMR4_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Инициализация таймера TIM4. </p>
<p>Прерывание таймера TIM4 используется для определения времени без приёма АРСФ пакета или АРС сигнала.</p>
<p>Таймер инициализируется со следующими параметрами:</p><ul>
<li>Частота 2 Гц</li>
<li>Период 0,5 с </li>
</ul>

</div>
</div>
<a id="a2f9bd7b9273ce18ca6275e4a3f943eda" name="a2f9bd7b9273ce18ca6275e4a3f943eda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f9bd7b9273ce18ca6275e4a3f943eda">&#9670;&#160;</a></span>VarReInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VarReInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Обнуление переменных и массивов, используемых в АРСФ режиме </p>
<p>Обнуляемые переменные и массивы:</p><ul>
<li><a class="el" href="_t_i_m__lib_8c.html#a2c38447b8253c8df855e3131c95941a1">tick</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a0c8f21a03cfb93d09d39d6afb04fbf5a">PrevVoltage</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a65abd7c55078faafaee66951c6aa38e2">FalseActivation</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#af7eacd3464df86c7d1cfc2f6435e76b8">fft_pos</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a></li>
<li><a class="el" href="_t_i_m__lib_8c.html#a42489e419158b2e29f4d5ab5631ebc1f">voltageBuff</a></li>
</ul>
<p>Также запускает <a class="el" href="_signal_receive_handler_8c.html#a77eede80ed2cacdccb407546376b853b">HandlerVarReInit()</a>. Используется в KEY1_IRQHandler() при переключении режимов работы устройства и в <a class="el" href="_signal_receive_handler_8c.html#ab53fdddca3f5eb3f9d44cdb67de13707">ReceiveStop()</a> после окончания приёма АРСФ пакетов </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad14650db362e7e1e1d34b5a4084cc9f1" name="ad14650db362e7e1e1d34b5a4084cc9f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad14650db362e7e1e1d34b5a4084cc9f1">&#9670;&#160;</a></span>EndOfSample</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t EndOfSample[8 *5+2+1] = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит информацию о временных промежутках (в тиках таймера), которые соотвутсвуют началу и концу найденных фазовых переходов (конец предыдущего - начало следующего). Значения элементов EndOfSample определяются в ZeroCrossAnalysis() и используются в Demodulation() </p>

</div>
</div>
<a id="a65abd7c55078faafaee66951c6aa38e2" name="a65abd7c55078faafaee66951c6aa38e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65abd7c55078faafaee66951c6aa38e2">&#9670;&#160;</a></span>FalseActivation</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t FalseActivation = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит информацию о том, что текущий приём пакета был определён как ложный (см. <a class="el" href="_signal_receive_handler_8c.html#aa7a4e39e588af7e90209b4822d951e60" title="Определяет ложный приём пакета">FasleActivationCatch</a>) </p>

</div>
</div>
<a id="a023d44daad4b1ebc1b7dfe8ed37cc27b" name="a023d44daad4b1ebc1b7dfe8ed37cc27b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a023d44daad4b1ebc1b7dfe8ed37cc27b">&#9670;&#160;</a></span>FFT_Buff</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double FFT_Buff[FFT_N] = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Массив, хранящий выборку данных для частотного анализа АРС пакета. Заполняется в прерывании таймера <a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017" title="Прерывание таймера TIM3.">TMR3_EventCallback</a>. Подробнее в SpectrumAnalysis </p>

</div>
</div>
<a id="af7eacd3464df86c7d1cfc2f6435e76b8" name="af7eacd3464df86c7d1cfc2f6435e76b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7eacd3464df86c7d1cfc2f6435e76b8">&#9670;&#160;</a></span>fft_pos</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t fft_pos = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Счётчик позиции текущего элемента для записи в <a class="el" href="_t_i_m__lib_8c.html#a023d44daad4b1ebc1b7dfe8ed37cc27b">FFT_Buff</a>. Изменяется и используется в <a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017" title="Прерывание таймера TIM3.">TMR3_EventCallback</a> </p>

</div>
</div>
<a id="a06d87010c135671bee571365d31ba043" name="a06d87010c135671bee571365d31ba043"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06d87010c135671bee571365d31ba043">&#9670;&#160;</a></span>LowLevel</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t LowLevel = 1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит информацию о том, что текущий приём АРС сигнала некачественный (сигнал низкого уровня). Значение LowLevel = 1 соответсвует сигналу низкого уровня. Значение LowLevel = 0 соответсвует сигналу высокого уровня. Значение LowLevel определяется в <a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017" title="Прерывание таймера TIM3.">TMR3_EventCallback</a> и используется при определении частоты принятого АРС сигнала (см. SpectrumAnalysis) </p>

</div>
</div>
<a id="a0c8f21a03cfb93d09d39d6afb04fbf5a" name="a0c8f21a03cfb93d09d39d6afb04fbf5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c8f21a03cfb93d09d39d6afb04fbf5a">&#9670;&#160;</a></span>PrevVoltage</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double PrevVoltage = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Предыдущее значение напряжения (полученное при предшествующем прерывании таймера <a class="el" href="_t_i_m__lib_8c.html#a8a79c36e2eef10dc903cea4c011028b3" title="Прерывание таймера TIM2.">TMR2_EventCallback</a>) </p>

</div>
</div>
<a id="a2093496d4e94f2686e755b4836a9586f" name="a2093496d4e94f2686e755b4836a9586f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2093496d4e94f2686e755b4836a9586f">&#9670;&#160;</a></span>RealVoltage</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double RealVoltage = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Текущее значение полученного на АЦП "действительного" напряжения в милливольтах. Подробнее в <a class="el" href="_a_d_c__lib_8c.html#aefac2e00e12a4d31bde8f7ee88c96c3d" title="Получение уровня напряжение с АЦП">GetRealVoltage</a> </p>

</div>
</div>
<a id="a2c38447b8253c8df855e3131c95941a1" name="a2c38447b8253c8df855e3131c95941a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c38447b8253c8df855e3131c95941a1">&#9670;&#160;</a></span>tick</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tick = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Значение тика таймера (счётчик срабатываний прерывания) с начала приёма текщуего АРСФ пакета </p>

</div>
</div>
<a id="a42489e419158b2e29f4d5ab5631ebc1f" name="a42489e419158b2e29f4d5ab5631ebc1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42489e419158b2e29f4d5ab5631ebc1f">&#9670;&#160;</a></span>voltageBuff</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double voltageBuff[VOL_BUF_LEN] = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Массив, хранящий данные о принятом АРС сигнале в виде значений напряжения. Заполняется в прерывании таймера <a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017" title="Прерывание таймера TIM3.">TMR3_EventCallback</a>. Используется для определения амплитуды принятого АРС сигнала в <a class="el" href="_a_m_p_8c.html#adbea7f0464f380bf508408bb38fbb5a9" title="Подсчет средней амплитуды принятого сигнала">AmlitudeAnalysis</a> </p>

</div>
</div>
<a id="a74adc192bb0536a83f57a129efa1400f" name="a74adc192bb0536a83f57a129efa1400f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74adc192bb0536a83f57a129efa1400f">&#9670;&#160;</a></span>voltageBuffCounter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t voltageBuffCounter = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Счётчик позиции текущего элемента для записи в <a class="el" href="_t_i_m__lib_8c.html#a42489e419158b2e29f4d5ab5631ebc1f">voltageBuff</a>. Используется для определения уровня напряжения для текущего приёма АРС сигнала. Изменяется и используется в <a class="el" href="_t_i_m__lib_8c.html#ae928af867d4f146922f1cb3af9bbf017" title="Прерывание таймера TIM3.">TMR3_EventCallback</a> </p>

</div>
</div>
<a id="a7558533ab0553c6f22905cb4a83f93c3" name="a7558533ab0553c6f22905cb4a83f93c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7558533ab0553c6f22905cb4a83f93c3">&#9670;&#160;</a></span>VoltagesData</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double VoltagesData[(32+5 *8 *16) *8] = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит данные по принятом пакете в виде значений напряжения, полученное при каждом прерывании таймера <a class="el" href="_t_i_m__lib_8c.html#a8a79c36e2eef10dc903cea4c011028b3" title="Прерывание таймера TIM2.">TMR2_EventCallback</a>. Используется для демодуляции полученного АРСФ пакета. Также используется в <a class="el" href="_a_m_p_8c.html#adbea7f0464f380bf508408bb38fbb5a9" title="Подсчет средней амплитуды принятого сигнала">AmlitudeAnalysis</a> для определения амплитуды полученного пакета </p>

</div>
</div>
<a id="a43d2c695c558f49cb2df8c0745c28531" name="a43d2c695c558f49cb2df8c0745c28531"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43d2c695c558f49cb2df8c0745c28531">&#9670;&#160;</a></span>ZeroCrossTimings</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ZeroCrossTimings[700] = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит время переходов сигнала через 0V (снизу). Подробнее в ZeroCrossAnalysis </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f396504afdc959660871b003fa10164d.html">Documents</a></li><li class="navelem"><a class="el" href="dir_8e868eb912c045a3346be088bc60331b.html">Keil</a></li><li class="navelem"><a class="el" href="dir_221782dba50d5657e716c168483b326f.html">DQPSK_plus_Freq</a></li><li class="navelem"><a class="el" href="dir_10c1ba3ff968427fc90347fa71957050.html">Source</a></li><li class="navelem"><a class="el" href="_t_i_m__lib_8c.html">TIM_lib.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
