<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DQPSK_plus_Freq: Documents/Keil/DQPSK_plus_Freq/Source/PM.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DQPSK_plus_Freq
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_p_m_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">PM.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Обработка АРСФ пакетов  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;PM.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a344fb96b570c7c0c1e6f6d81e418ec82"><td class="memItemLeft" align="right" valign="top"><a id="a344fb96b570c7c0c1e6f6d81e418ec82" name="a344fb96b570c7c0c1e6f6d81e418ec82"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TICKS_NUM</b>&#160;&#160;&#160;(5376)</td></tr>
<tr class="separator:a344fb96b570c7c0c1e6f6d81e418ec82"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad2390af362a4e67b648e37d8f4203f8e"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#ad2390af362a4e67b648e37d8f4203f8e">Decoding</a> (uint8_t *High, uint8_t *Low)</td></tr>
<tr class="memdesc:ad2390af362a4e67b648e37d8f4203f8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Декодирование демодулированной последовательности  <br /></td></tr>
<tr class="separator:ad2390af362a4e67b648e37d8f4203f8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f8b9084b63f6c1cabd4df3a1d9861b2"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a8f8b9084b63f6c1cabd4df3a1d9861b2">BauerToOrig</a> (uint16_t data, uint8_t *ErrorVar)</td></tr>
<tr class="memdesc:a8f8b9084b63f6c1cabd4df3a1d9861b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Табличный переход от кода Бауера к исходному числу  <br /></td></tr>
<tr class="separator:a8f8b9084b63f6c1cabd4df3a1d9861b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ec6aff347d982145234794aeda45232"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a5ec6aff347d982145234794aeda45232">SpeedLimit</a> (uint16_t DQPSK_code)</td></tr>
<tr class="memdesc:a5ec6aff347d982145234794aeda45232"><td class="mdescLeft">&#160;</td><td class="mdescRight">Табличный переход от hex кода к разрешенной скорости  <br /></td></tr>
<tr class="separator:a5ec6aff347d982145234794aeda45232"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad661cb7c42214740f919cf580a37ffec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#ad661cb7c42214740f919cf580a37ffec">AnalysisEnd</a> ()</td></tr>
<tr class="memdesc:ad661cb7c42214740f919cf580a37ffec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Присвоение идентификаторам дефолтных значений  <br /></td></tr>
<tr class="separator:ad661cb7c42214740f919cf580a37ffec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f059a669299ce6cdba20cf4efbd6186"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a9f059a669299ce6cdba20cf4efbd6186">ZeroCrossAnalysis</a> (double *<a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a>, double *<a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a>, int8_t <a class="el" href="_signal_receive_handler_8c.html#acb44ab2601e211bf879fb56de0ab915d">StartSign</a>, uint16_t *<a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a>)</td></tr>
<tr class="memdesc:a9f059a669299ce6cdba20cf4efbd6186"><td class="mdescLeft">&#160;</td><td class="mdescRight">Обработка АРСФ пакета, определение переходов через 0, временных промежутков между фазовыми переходами  <br /></td></tr>
<tr class="separator:a9f059a669299ce6cdba20cf4efbd6186"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa92798f5c24b17ca3e65c262581731f5"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#aa92798f5c24b17ca3e65c262581731f5">Demodulation</a> (double *<a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a>, uint16_t *<a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a>, uint8_t *High, uint8_t *Low)</td></tr>
<tr class="memdesc:aa92798f5c24b17ca3e65c262581731f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Демодуляцмя АРСФ пакета  <br /></td></tr>
<tr class="separator:aa92798f5c24b17ca3e65c262581731f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6def050aeb552326bca23e18bb543253"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a6def050aeb552326bca23e18bb543253">CodeSearch</a> (uint8_t *High, uint8_t *Low, uint8_t *BadState, uint8_t *Counter)</td></tr>
<tr class="memdesc:a6def050aeb552326bca23e18bb543253"><td class="mdescLeft">&#160;</td><td class="mdescRight">Поиск кода в демодулированных последовательностях (старшая и младшая тетрада)  <br /></td></tr>
<tr class="separator:a6def050aeb552326bca23e18bb543253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b128c019f76d2ce6ef40889be713f9c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a6b128c019f76d2ce6ef40889be713f9c">ArrayShift</a> (uint8_t *High, uint8_t *Low, uint8_t *NewHigh, uint8_t *NewLow, uint16_t Length, uint16_t Shift)</td></tr>
<tr class="memdesc:a6b128c019f76d2ce6ef40889be713f9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Сдвиг массива на Shift позиций вправо  <br /></td></tr>
<tr class="separator:a6b128c019f76d2ce6ef40889be713f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9034567489c62c060cb0fd75598562b3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a9034567489c62c060cb0fd75598562b3">TimerFreq</a> = 26785.714285</td></tr>
<tr class="separator:a9034567489c62c060cb0fd75598562b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26426600f7e0c2d26c771d54a94405ab"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a26426600f7e0c2d26c771d54a94405ab">TimerPeriod</a> = 1/26785.714285</td></tr>
<tr class="separator:a26426600f7e0c2d26c771d54a94405ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43016d873124d39034edb8cd164794db"><td class="memItemLeft" align="right" valign="top">const double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a43016d873124d39034edb8cd164794db">pi</a> = 3.14159265359</td></tr>
<tr class="separator:a43016d873124d39034edb8cd164794db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d367e6594b0578aa29b017d6763095f"><td class="memItemLeft" align="right" valign="top"><a id="a2d367e6594b0578aa29b017d6763095f" name="a2d367e6594b0578aa29b017d6763095f"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>PeriodCount</b> = 0</td></tr>
<tr class="separator:a2d367e6594b0578aa29b017d6763095f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a073bdb7c297960b4d9332ce4d89d1eca"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a073bdb7c297960b4d9332ce4d89d1eca">ThroughPeriodCount</a> = 0</td></tr>
<tr class="separator:a073bdb7c297960b4d9332ce4d89d1eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8f9b9688782071d739af704c71a1718"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#af8f9b9688782071d739af704c71a1718">PrevCrossTick</a> = 0</td></tr>
<tr class="separator:af8f9b9688782071d739af704c71a1718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f189c2f26f1ad1b9de5ec6d79fe514a"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a9f189c2f26f1ad1b9de5ec6d79fe514a">SampleCounter</a> = 0</td></tr>
<tr class="separator:a9f189c2f26f1ad1b9de5ec6d79fe514a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f945a1b7b1640ec42ad649537247fa2"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a1f945a1b7b1640ec42ad649537247fa2">PeriodContinues</a> = 0</td></tr>
<tr class="separator:a1f945a1b7b1640ec42ad649537247fa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a862b08c0eb6b711fc9a9f23353ad9244"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_p_m_8c.html#a862b08c0eb6b711fc9a9f23353ad9244">FirstPer</a> = 1</td></tr>
<tr class="separator:a862b08c0eb6b711fc9a9f23353ad9244"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6436cc5b6507336f1333b5d2c6073bb3"><td class="memItemLeft" align="right" valign="top"><a id="a6436cc5b6507336f1333b5d2c6073bb3" name="a6436cc5b6507336f1333b5d2c6073bb3"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>ErrorMessage</b> [3] = {'B', 'A', 'D'}</td></tr>
<tr class="separator:a6436cc5b6507336f1333b5d2c6073bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Обработка АРСФ пакетов </p>
<dl class="section version"><dt>Version</dt><dd>V1.0.0</dd></dl>
<dl class="section date"><dt>Date</dt><dd>02-10-2023 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad661cb7c42214740f919cf580a37ffec" name="ad661cb7c42214740f919cf580a37ffec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad661cb7c42214740f919cf580a37ffec">&#9670;&#160;</a></span>AnalysisEnd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AnalysisEnd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Присвоение идентификаторам дефолтных значений </p>
<p>Функция возвращает переменные, используемые в <a class="el" href="_p_m_8c.html#a9f059a669299ce6cdba20cf4efbd6186">ZeroCrossAnalysis()</a> к значениям при инициализации для нормального анализа следующего пакета </p>

</div>
</div>
<a id="a6b128c019f76d2ce6ef40889be713f9c" name="a6b128c019f76d2ce6ef40889be713f9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b128c019f76d2ce6ef40889be713f9c">&#9670;&#160;</a></span>ArrayShift()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ArrayShift </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>High</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Low</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>NewHigh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>NewLow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Shift</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Сдвиг массива на Shift позиций вправо </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">High</td><td>Последовательность исходного кода (старшая тетрада) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Low</td><td>Последовательнось исходного кода (младшая тетрада) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">NewHigh</td><td>Последовательность со сдвигом (старшая тетрада) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">NewLow</td><td>Последовательность со сдвигом (младшая тетрада) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Length</td><td>Длинна массивов </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Shift</td><td>Сдвиг</td></tr>
  </table>
  </dd>
</dl>
<p>Сдвиг принятых массивов High и Low на Shift позиций вправо. Используется в <a class="el" href="_p_m_8c.html#ad2390af362a4e67b648e37d8f4203f8e" title="Декодирование демодулированной последовательности">Decoding</a> для поиска АРСФ кода. Необходимо потому, что <a class="el" href="_p_m_8c.html#a9f059a669299ce6cdba20cf4efbd6186" title="Обработка АРСФ пакета, определение переходов через 0, временных промежутков между фазовыми переходами">ZeroCrossAnalysis</a> может не точно определять начало АРСФ пакета, поэтому возможна случайная комбинация кодов в начале High и Low последовательностей. Чтобы это устранить была сделана система сдвига этих массивов, в результате чего при 8 вызовах ArrayShift с Shift = 1, 2..8 мы сможем перебрать все возможные комбинации кодов. </p>

</div>
</div>
<a id="a8f8b9084b63f6c1cabd4df3a1d9861b2" name="a8f8b9084b63f6c1cabd4df3a1d9861b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f8b9084b63f6c1cabd4df3a1d9861b2">&#9670;&#160;</a></span>BauerToOrig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t BauerToOrig </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>ErrorVar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Табличный переход от кода Бауера к исходному числу </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>демодулированное hex число (код Бауера) </td></tr>
    <tr><td class="paramname">ErrorVar</td><td>ссылка на идентификатор ошибки перехода</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Orig</td><td>исходный код</td></tr>
  </table>
  </dd>
</dl>
<p>Возвращает табличное значение исходного кода, которому соответсвует полученный код Бауера. Если такого кода нет, то возвращает невозможное число 0xff, *ErrorVar = 1 </p>

</div>
</div>
<a id="a6def050aeb552326bca23e18bb543253" name="a6def050aeb552326bca23e18bb543253"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6def050aeb552326bca23e18bb543253">&#9670;&#160;</a></span>CodeSearch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t CodeSearch </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>High</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Low</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>BadState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Counter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Поиск кода в демодулированных последовательностях (старшая и младшая тетрада) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">High</td><td>Последовательность исходного кода (старшая тетрада) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Low</td><td>Последовательнось исходного кода (младшая тетрада) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">BadState</td><td>Идентификатор невозможности декодировать входные данные </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Counter</td><td>Количество удачно найденных кодов</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">GoodCode</td><td>Полученный hex АРСФ код</td></tr>
  </table>
  </dd>
</dl>
<p>Для переданной последовательности (High, Low) производит поиск АРСФ кода, используя табличные значения (см. BauerToOrig). АРСФ код считается правдоподобным, если количество одинаковых кодов больше единицы (Counter &gt; 1) </p>

</div>
</div>
<a id="ad2390af362a4e67b648e37d8f4203f8e" name="ad2390af362a4e67b648e37d8f4203f8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2390af362a4e67b648e37d8f4203f8e">&#9670;&#160;</a></span>Decoding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Decoding </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>High</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Low</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Декодирование демодулированной последовательности </p>
<p>Содержит информацию о том, что текущий фазовый переход первый</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">High</td><td>Последовательность исходного кода (старшая тетрада) </td></tr>
    <tr><td class="paramname">Low</td><td>Последовательнось исходного кода (младшая тетрада)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">BadState</td><td>Идентификатор ошибки декодирования</td></tr>
  </table>
  </dd>
</dl>
<p>Выполняет поиск АРСФ кода для исходной последовательности. Если код не был обнаружен, массив сдвигается вправо (см. <a class="el" href="_p_m_8c.html#a6b128c019f76d2ce6ef40889be713f9c" title="Сдвиг массива на Shift позиций вправо">ArrayShift</a>), поиск продолжается вплоть до 7-ми сдвигов. Если был получен достоверный код (т.е. код был обнаружен в последовательности более одного раза), то результат отправляется по USART и выводится на LCD экран (см. <a class="el" href="_l_c_d__lib_8c.html#a67d65e7546dc387e220507035c7c4346" title="Отображения результата декодирования АРСФ на LCD экране">LCD_DQPSK_Result</a>), программа возвращает 0. Если достоверный код не был обнаружен, то по USART отправляется сообщение об ошибке, программа возвращает 1. При долгом отсутсвии приёма (более 1,5 сек) информация о коде пропадёт и с LCD экрана (см. <a class="el" href="_l_c_d__lib_8c.html#ad4fcbc10f1d0f8b3738d929d33386ccc" title="Отображение состояния">LCD_Show_No_Result</a>). </p>

</div>
</div>
<a id="aa92798f5c24b17ca3e65c262581731f5" name="aa92798f5c24b17ca3e65c262581731f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa92798f5c24b17ca3e65c262581731f5">&#9670;&#160;</a></span>Demodulation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Demodulation </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>ZeroCrossTimings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>EndOfSample</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>High</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Low</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Демодуляцмя АРСФ пакета </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ZeroCrossTimings</td><td>Значения времени при переходах через 0. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">EndOfSample</td><td>Значения временных промежутков для каждого фазового перехода. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">High</td><td>Декодированный исходный код (старшая тетрада) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Low</td><td>Декодированный исходный код (младшая тетрада)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ExitCode</td><td>идентификатор удачной демодуляции</td></tr>
  </table>
  </dd>
</dl>
<p>По полученным из <a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a> данным находим бинарный код, путём подсчёта фазовых сдвигов. Фазовые сдвиги определяются исходя из времени переходов через ноль внутри фазовых переходов.</p>
<p>Логика демодуляции следующая:</p><ul>
<li>Считается нулевая фаза, т.е. фаза, относительно которой будут подсчитаны фазовые сдвиги. Фаза считается как остаток от деления времени перехода через 0 на период колебаний несущей, далее находится их среднее арифметическое, что и считается за нулевую фазу</li>
<li>Для остальных фазовых переходов фазовый находится как наиболее распространённое значение. Другими словами, среднее арифметическое заменяется на количество фаз, попадающих в промежуток. Например, если будут получены фазы 0 0 pi pi/2, то результатом будет 0, а не pi/2</li>
<li>По полученному фазовому сдвигу находится бинарный код, которому этот фазовый переход соответсвует. Так фазовый переход 0 соответсвует коду 00, pi/2 - 10, pi - 11, -pi/2 - 01. Полученный результат суммируется с нулевой фазой и используется как нулевая фаза для следующего фазового перехода</li>
<li>После демодуляции всех 40 фазовых переходов, запускается поиск АРСФ кода <a class="el" href="_p_m_8c.html#ad2390af362a4e67b648e37d8f4203f8e" title="Декодирование демодулированной последовательности">Decoding</a> </li>
</ul>

</div>
</div>
<a id="a5ec6aff347d982145234794aeda45232" name="a5ec6aff347d982145234794aeda45232"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ec6aff347d982145234794aeda45232">&#9670;&#160;</a></span>SpeedLimit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SpeedLimit </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>DQPSK_code</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Табличный переход от hex кода к разрешенной скорости </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DQPSK_code</td><td>декодированный АРСФ код</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">speedCode</td><td>Разрешенные скорости</td></tr>
  </table>
  </dd>
</dl>
<p>Возвращает табличное значение разрешенной скорости, которая соответсвует полученному АРСФ коду. Скорость возвращается в формате XXYY, где XX - КРЦ, YY - СРЦ. Информация о разрешенной скорости используется для отображения на LCD экране (см. <a class="el" href="_l_c_d__lib_8c.html#a67d65e7546dc387e220507035c7c4346" title="Отображения результата декодирования АРСФ на LCD экране">LCD_DQPSK_Result</a>) </p>

</div>
</div>
<a id="a9f059a669299ce6cdba20cf4efbd6186" name="a9f059a669299ce6cdba20cf4efbd6186"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f059a669299ce6cdba20cf4efbd6186">&#9670;&#160;</a></span>ZeroCrossAnalysis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ZeroCrossAnalysis </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>VoltagesData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>ZeroCrossTimings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>StartSign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>EndOfSample</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Обработка АРСФ пакета, определение переходов через 0, временных промежутков между фазовыми переходами </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VoltagesData</td><td>Значения напряжения </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ZeroCrossTimings</td><td>Полученные значения времени при переходах через 0. Используется при демодуляции пакета в <a class="el" href="_p_m_8c.html#aa92798f5c24b17ca3e65c262581731f5">Demodulation()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">StartSign</td><td>Стартовое напрявление полученного сигнала </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">EndOfSample</td><td>Полученные значения временных промежутков для каждого фазового перехода. Используется при демодуляции пакета в <a class="el" href="_p_m_8c.html#aa92798f5c24b17ca3e65c262581731f5">Demodulation()</a></td></tr>
  </table>
  </dd>
</dl>
<p>Функция находит в принятом сигнале переходы через 0 <a class="el" href="_t_i_m__lib_8c.html#a43d2c695c558f49cb2df8c0745c28531">ZeroCrossTimings</a> и использует эту информацию для заполнения <a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a></p>
<p>Логика анализа следующая:</p><ul>
<li>Определяется переход через ноль (его тик, т.е. временной эквивалент)</li>
<li>Если между текущим и прошлым переходом через 0 ровно 8 тиков, то считается что измерения происходят внутри одного фазового перехода, увеличивается <a class="el" href="_p_m_8c.html#a073bdb7c297960b4d9332ce4d89d1eca">ThroughPeriodCount</a></li>
<li>Проверка на <a class="el" href="_p_m_8c.html#a1f945a1b7b1640ec42ad649537247fa2">PeriodContinues</a>: если PeriodContinues == 0, то есть период не продолжается (или другими словами, предыдущий фазовый переход закончился), тогда, если пройдена проверка, информация о фазовом переходе записывается в <a class="el" href="_t_i_m__lib_8c.html#ad14650db362e7e1e1d34b5a4084cc9f1">EndOfSample</a>, увеличивается <a class="el" href="_p_m_8c.html#a9f189c2f26f1ad1b9de5ec6d79fe514a">SampleCounter</a>. Проверка заключается в определении PeriodCount для текущего фазового перехода. Учитывая, что в фазовом переходе должно быть 16 периодов, то можно предположить, что при PeriodCount &lt; 6 анализ был произведён неверно, текущий фазовый переход ложный. В таком случае, информация о PeriodCount удаляется из <a class="el" href="_p_m_8c.html#a073bdb7c297960b4d9332ce4d89d1eca">ThroughPeriodCount</a></li>
<li>Если в течении 15 периодов не был обнаружен фазовый переход, то считается, что он произошел с нулевым изменением фазы</li>
<li>Если между текущим и прошлым переходом через 0 не 8 тиков, то считается, что текущий фазовый переход завершился, <a class="el" href="_p_m_8c.html#a1f945a1b7b1640ec42ad649537247fa2">PeriodContinues</a> = 0</li>
<li>Когда <a class="el" href="_p_m_8c.html#a9f189c2f26f1ad1b9de5ec6d79fe514a">SampleCounter</a> &gt; 43 или <a class="el" href="_p_m_8c.html#a073bdb7c297960b4d9332ce4d89d1eca">ThroughPeriodCount</a> &gt; 700, функция заканчивает работу и вызывает <a class="el" href="_p_m_8c.html#ad661cb7c42214740f919cf580a37ffec">AnalysisEnd()</a></li>
<li>Если за время анализа <a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a> предыдущий пункт не выполнился, то последняя точка <a class="el" href="_t_i_m__lib_8c.html#a7558533ab0553c6f22905cb4a83f93c3">VoltagesData</a> считается за конец последнего фазового перехода, вызывается <a class="el" href="_p_m_8c.html#ad661cb7c42214740f919cf580a37ffec">AnalysisEnd()</a> </li>
</ul>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a862b08c0eb6b711fc9a9f23353ad9244" name="a862b08c0eb6b711fc9a9f23353ad9244"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a862b08c0eb6b711fc9a9f23353ad9244">&#9670;&#160;</a></span>FirstPer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t FirstPer = 1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Содержит информацию о том, что текущий фазовый переход продолжается </p>

</div>
</div>
<a id="a1f945a1b7b1640ec42ad649537247fa2" name="a1f945a1b7b1640ec42ad649537247fa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f945a1b7b1640ec42ad649537247fa2">&#9670;&#160;</a></span>PeriodContinues</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t PeriodContinues = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Количество принятых фазовых переходов </p>

</div>
</div>
<a id="a43016d873124d39034edb8cd164794db" name="a43016d873124d39034edb8cd164794db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43016d873124d39034edb8cd164794db">&#9670;&#160;</a></span>pi</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double pi = 3.14159265359</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Число пи </p>

</div>
</div>
<a id="af8f9b9688782071d739af704c71a1718" name="af8f9b9688782071d739af704c71a1718"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8f9b9688782071d739af704c71a1718">&#9670;&#160;</a></span>PrevCrossTick</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t PrevCrossTick = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Общее количество периодов несущей, принятых для АРСФ пакета </p>

</div>
</div>
<a id="a9f189c2f26f1ad1b9de5ec6d79fe514a" name="a9f189c2f26f1ad1b9de5ec6d79fe514a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f189c2f26f1ad1b9de5ec6d79fe514a">&#9670;&#160;</a></span>SampleCounter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SampleCounter = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Общее количество периодов несущей, принятых для АРСФ пакета </p>

</div>
</div>
<a id="a073bdb7c297960b4d9332ce4d89d1eca" name="a073bdb7c297960b4d9332ce4d89d1eca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a073bdb7c297960b4d9332ce4d89d1eca">&#9670;&#160;</a></span>ThroughPeriodCount</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t ThroughPeriodCount = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Количество периодов несущей, принятых для текущего фазового перехода </p>

</div>
</div>
<a id="a9034567489c62c060cb0fd75598562b3" name="a9034567489c62c060cb0fd75598562b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9034567489c62c060cb0fd75598562b3">&#9670;&#160;</a></span>TimerFreq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double TimerFreq = 26785.714285</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Частота таймера TIM2 (см. <a class="el" href="_t_i_m__lib_8c.html#ad4667872eeecb6411675ef94133723fd" title="Инициализация таймера TIM2.">TMR2_Init</a>) </p>

</div>
</div>
<a id="a26426600f7e0c2d26c771d54a94405ab" name="a26426600f7e0c2d26c771d54a94405ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26426600f7e0c2d26c771d54a94405ab">&#9670;&#160;</a></span>TimerPeriod</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double TimerPeriod = 1/26785.714285</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Период таймера TIM2 (см. <a class="el" href="_t_i_m__lib_8c.html#ad4667872eeecb6411675ef94133723fd" title="Инициализация таймера TIM2.">TMR2_Init</a>) </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f396504afdc959660871b003fa10164d.html">Documents</a></li><li class="navelem"><a class="el" href="dir_8e868eb912c045a3346be088bc60331b.html">Keil</a></li><li class="navelem"><a class="el" href="dir_221782dba50d5657e716c168483b326f.html">DQPSK_plus_Freq</a></li><li class="navelem"><a class="el" href="dir_10c1ba3ff968427fc90347fa71957050.html">Source</a></li><li class="navelem"><a class="el" href="_p_m_8c.html">PM.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
